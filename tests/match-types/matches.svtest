require "vnd.dovecot.testsuite";

test_set "message" text:
From: stephan+sieve@drunksnipers.com
To: sirius@rename-it.nl
To: nico@vestingbar.nl
Cc: me@example.com
Cc: timo@dovecot.com
X-Hufter: TRUE
Subject: make your money very fast!!!
X-Spam-Score: **********
X-Bullshit: 33333???a
Message-ID: <90a02fe01fc25e131d0e9c4c45975894@example.com>
Comment:                                            

Het werkt!
.
;

/*
 * Matching tests
 */

# Empty string
test "Empty string" {
	if not header :matches "comment" "" {
		test_fail "failed to match \"\" against \"\"";
	}

	if not header :matches "comment" "*" {
		test_fail "failed to match \"\" against \"*\"";
	}

	if header :matches "comment" "?" {
		test_fail "inappropriately matched \"\" against \"?\"";
	}
}

stop;

test "MATCH-A" {
	if not address :matches "from" "*@d*ksn*ers.com" {
		test_fail "should have matched";
	}
}

test "MATCH-B" {
	if not address :matches "from" "stephan+sieve@drunksnipers.*" {
		test_fail "should have matched";
	}
}

test "MATCH-C" {
	if not address :matches "from" "*+sieve@drunksnipers.com" {
		test_fail "should have matched";
	}
}

test "MATCH-D" {
	if not address :matches "from" "stephan+sieve?drunksnipers.com" {
		test_fail "should have matched";
	}
}

test "MATCH-E" {
	if not address :matches "from" "?tephan+sieve@drunksnipers.com" {
		test_fail "should have matched";
	}
}

test "MATCH-F" {
	if not address :matches "from" "stephan+sieve@drunksnipers.co?" {
		test_fail "should have matched";
	}
}

test "MATCH-G" {
	if not address :matches "from" "?t?phan?sieve?drunksnip?rs.co?" {
		test_fail "should have matched";
	}
}

test "MATCH-H" {
	if not header :matches "x-bullshit" "33333\\?\\?\\??" {
		test_fail "should have matched";
	}
}


test "MATCH-I" {
	if not header :matches "x-bullshit" "33333*\\?\\??" {
		test_fail "should have matched";
	}
}

test "MATCH-J" {
	if not header :matches "X-Bullshit" "*\\?\\?\\?a" {
		test_fail "should have matched";
	}
}

test "MATCH-K" {
	if not header :matches "x-bullshit" "*3333\\?\\?\\?a" {
		test_fail "should have matched";
	}
}

test "MATCH-L" {
	if not header :matches "x-spam-score" "\\*\\*\\*\\*\\**" {
		test_fail "should have matched";
	}
}

test "MATCH-M" {
	if not header :matches "x-spam-score" "\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*" {
		test_fail "should have matched";
	}
}

test "MATCH-N" {
	if not header :matches "x-spam-score" "\\*\\*\\***\\*\\*" {
		test_fail "should have matched";
	}
}

test "MATCH-O" {
	if not header :matches "x-spam-score" "\\*?\\*?\\*?\\*?\\*?" {
		test_fail "should have matched";
	}
}

# Non-matching tests

test "NO-MATCH-A" {
	if address :matches "from" "*@d*kn*ers.com" {
		test_fail "should not have matched";
	}
}

test "NO-MATCH-B" {
	if address :matches "from" "stepan+sieve@drunksnipers.*" {
		test_fail "should not have matched";
	}
}

test "NO-MATCH-C" {
	if address :matches "from" "*+sieve@drunksnipers.om" {
		test_fail "should not have matched";
	}
}

test "NO-MATCH-D" {
	if address :matches "from" "stephan+sieve?drunksipers.com" {
		test_fail "should not have matched";
	}
}

test "NO-MATCH-E" {
	if address :matches "from" "?tephan+sievedrunksnipers.com" {
		test_fail "should not have matched";
	}
}

test "NO-MATCH-F" {
	if address :matches "from" "sephan+sieve@drunksnipers.co?" {
		test_fail "should not have matched";
	}
}

test "NO-MATCH-G" {
	if address :matches "from" "?t?phan?sieve?dunksnip?rs.co?" {
		test_fail "should not have matched";
	}
}

test "NO-MATCH-H" {
	if header :matches "x-bullshit" "33333\\?\\?\\?" {
		test_fail "should not have matched";
	}
}

test "NO-MATCH-I" {
	if header :matches "x-bullshit" "33333\\?\\?\\?aa" {
		test_fail "should not have matched";
	}
}

test "NO-MATCH-J" {
	if header :matches "x-bullshit" "\\*3333\\?\\?\\?a" {
		test_fail "should not have matched";
	}
}

test "NO-MATCH-K" {
	if header :matches "x-bullshit" "\\f3333\\?\\?\\?a" {
		test_fail "should not have matched";
	}
}

test "NO-MATCH-L" {
	if header :matches "x-spam-score" "\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*" {
		test_fail "should not have matched";
	}
}


test "NO-MATCH-M" {
	if header :matches "x-spam-score" "\\*?\\*?\\*?\\*?\\*??" {
		test_fail "should not have matched";
	}
}


