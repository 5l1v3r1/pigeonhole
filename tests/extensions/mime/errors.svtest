require "vnd.dovecot.testsuite";

require "relational";
require "comparator-i;ascii-numeric";

test "Foreverypart command" {
	if test_script_compile "errors/foreverypart.sieve" {
		test_fail "compile should have failed";
	}

	if test_error :count "ne" :comparator "i;ascii-numeric" "12" {
		test_fail "incorrect number of compile errors reported";
	}
}

test "Break command" {
	if test_script_compile "errors/break.sieve" {
		test_fail "compile should have failed";
	}

	if test_error :count "ne" :comparator "i;ascii-numeric" "21" {
		test_fail "incorrect number of compile errors reported";
	}
}

test "Header test with :mime tag" {
	if test_script_compile "errors/header-mime-tag.sieve" {
		test_fail "compile should have failed";
	}

	if test_error :count "ne" :comparator "i;ascii-numeric" "10" {
		test_fail "incorrect number of compile errors reported";
	}
}

test "Address test with :mime tag" {
	if test_script_compile "errors/address-mime-tag.sieve" {
		test_fail "compile should have failed";
	}

	if test_error :count "ne" :comparator "i;ascii-numeric" "6" {
		test_fail "incorrect number of compile errors reported";
	}
}

test "Exists test with :mime tag" {
	if test_script_compile "errors/exists-mime-tag.sieve" {
		test_fail "compile should have failed";
	}

	if test_error :count "ne" :comparator "i;ascii-numeric" "6" {
		test_fail "incorrect number of compile errors reported";
	}
}

test "Limits" {
	if test_script_compile "errors/limits.sieve" {
		test_fail "compile should have failed";
	}

	if test_error :count "ne" :comparator "i;ascii-numeric" "2" {
		test_fail "incorrect number of compile errors reported";
	}
}
