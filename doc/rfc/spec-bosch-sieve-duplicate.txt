


Pigeonhole Project                                              S. Bosch
                                                       February 25, 2012


         Sieve Email Filtering: Detecting Duplicate Deliveries

Abstract

   This document defines a new vendor-defined test command "duplicate"
   for the "Sieve" email filtering language that tests whether an e-mail
   message is a duplicate, i.e. whether it was seen before by the
   delivery agent.  Users can use this new test to remove duplicate
   deliveries commonly caused by mailing list subscriptions or mail
   account aliases.


Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . . . 2
   2.  Conventions Used in This Document . . . . . . . . . . . . . . . 2
   3.  Test "duplicate"  . . . . . . . . . . . . . . . . . . . . . . . 2
   4.  Sieve Capability Strings  . . . . . . . . . . . . . . . . . . . 3
   5.  Example . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3
   6.  Security Considerations . . . . . . . . . . . . . . . . . . . . 3
   7.  Normative References  . . . . . . . . . . . . . . . . . . . . . 3
   Author's Address  . . . . . . . . . . . . . . . . . . . . . . . . . 3

























Bosch                                                           [Page 1]

                  Sieve: Detecting Duplicate Deliveries    February 2012


1.  Introduction

   This is an extension to the Sieve filtering language defined by RFC
   5228 [SIEVE].  It adds a test to determine whether a message was seen
   before by the delivery agent based on the Message-ID header.

   Duplicate deliveries are a common side-effect of being subscribed to
   a mailing list.  If a member of the list decides to reply to both the
   user and the mailing list itself, the user will get a copy of the
   message directly and through mailing list.  In another scenario, the
   user has several aliases for his mail account and one of his contacts
   sends the message to multiple addresses that eventually map to the
   same account.  Using the vnd.dovecot.duplicate extension, users have
   the means to detect such duplicates and deal with these
   appropriately, e.g. by discarding them.

   This extension is specific to the Pigeonhole Sieve implementation for
   the Dovecot Secure IMAP server.  It will therefore most likely not be
   supported by web interfaces and GUI-based Sieve editors.


2.  Conventions Used in This Document

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [KEYWORDS].

   Conventions for notations are as in [SIEVE] Section 1.1, including
   use of the "Usage:" label for the definition of action and tagged
   arguments syntax.


3.  Test "duplicate"

   Usage: "duplicate" [<name: string>]

   The "duplicate" test keeps track of which Message-ID values were seen
   before by this test in an earlier delivery operation.  It evaluates
   to "true" when the Message-ID header of the current message was seen
   before.  If it is not known, the test evaluates to "false" and the
   Message-ID is added to a persistent internal tracking list.
   Implementations SHOULD limit the number of messages that are tracked
   and SHOULD let Message-ID entries expire after some short period of
   time.

   Using the "name" argument, the duplicate test can be employed for
   multiple independent purposes.  Only when the Message-ID was seen
   before in an earlier script execution by a duplicate test with the



Bosch                                                           [Page 2]

                  Sieve: Detecting Duplicate Deliveries    February 2012


   same "name" argument, it is recognized as a duplicate.


4.  Sieve Capability Strings

   A Sieve implementation that defines the "duplicate" test command will
   advertise the capability string "vnd.dovecot.duplicate".


5.  Example

   In this example, duplicate deliveries are stored in a special folder
   contained in the user's Trash folder.  If the folder does not exist,
   it is created.  This way, the user has a chance to recover messages
   when necessary.  Messages that are not recognized as duplicates are
   stored in the user's inbox as normal.

   require ["vnd.dovecot.duplicate", "fileinto", "mailbox"];

   if duplicate {
           fileinto :create "Trash/Duplicate";
   }


6.  Security Considerations

   A flood of unique messages could cause the list of tracked Message-
   IDs to grow indefinitely.  Implementations therefore SHOULD implement
   limits on the number and lifespan of entries in that list.


7.  Normative References

   [KEYWORDS]
              Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, March 1997.

   [SIEVE]    Guenther, P. and T. Showalter, "Sieve: An Email Filtering
              Language", RFC 5228, January 2008.












Bosch                                                           [Page 3]

                  Sieve: Detecting Duplicate Deliveries    February 2012


Author's Address

   Stephan Bosch
   Enschede
   NL

   Email: stephan@rename-it.nl












































Bosch                                                           [Page 4]

